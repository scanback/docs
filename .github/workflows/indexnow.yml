name: IndexNow

on:
  push:
    branches: ["main"]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Submit to IndexNow
        shell: bash
        run: |
          code=$(curl -sS -o /dev/null -w "%{http_code}" \
            -X POST "https://api.indexnow.org/indexnow" \
            -H "Content-Type: application/json; charset=utf-8" \
            -d '{
              "host": "scanback.github.io",
              "key": "${{ secrets.INDEXNOW_KEY }}",
              "urlList": [
                "https://scanback.github.io/docs/"
              ]
            }')

          echo "IndexNow HTTP status: $code"

          if [ "$code" != "200" ] && [ "$code" != "202" ]; then
            echo "IndexNow submission failed (HTTP $code)"
            exit 1
          fi
